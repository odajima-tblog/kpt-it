<% content_for :head do -%>
  <script src="http://twitter.github.com/bootstrap/1.4.0/bootstrap-tabs.js"></script>
  <script src="http://js.pusherapp.com/1.9/pusher.min.js"></script>
  <script>
    $(function () {
      var pusher  = new Pusher('<%= Pusher.key||ENV['PUSHER_KEY'] %>');
      var channel = pusher.subscribe("<%= @project.token %>");
      channel.bind("post-event", function(data) { eval(data); });
      $('.tabs').tabs();
      <% %w[keep problem try].each do |type| -%>
        $("#form_<%= type %>").submit(function(){return $("#post_<%= type %>_body").val().trim() ? true : false;});
      <% end -%>
    })
  </script>
<% end -%>

<div id="contents">
  <div class="textbox">
    <ul class="tabs cf">
      <% %w[keep problem try].each do |type| -%>
        <li class="<%= @type == type ? 'active' : '' %>">
        <a href="#<%= type %>"><%= type.camelize %></a>
        </li>
      <% end -%>
    </ul>
    <div class="textarea">
      <% %w[keep problem try].each do |type| -%>
        <div class="<%= @type == type ? 'active' : '' %>" id="<%= type %>">
          <form id="form_<%= type %>" accept-charset="UTF-8" action="/projects/<%= @project.token %>/<%= type %>" method="post" data-remote="true">
            <p>
            <input type="hidden" value="<%= type %>" name="type">
            <textarea id="post_<%= type %>_body" class="xxlarge" type="text" name="post[body]" placeholder="input <%= type %>"></textarea>
            <input class="btn primary" type="submit" value="Save">
            </p>
          </form>
        </div>
      <% end -%>
    </div>
  </div>
  <div id="main" class="cf">
    <div class="container">
      <h2><%=h @project.name %> のふりかえり</h2>
      <p class="lead"><%=h @project.description %></p>
    </div>

    <div class="row">
      <% %w[keep problem try].each do |type| -%>
        <section class="left" id="post-<%= type %>">
        <h3><%= type.camelize %></h3>
        <% post = @project.posts.where(type: type).desc(:created_at) %>
        <% if post.count > 0 -%>
          <% post.each do | post | -%>
            <%= partial 'projects/post', locals: {project: @project, post: post} %>
          <% end -%>
        <% else -%>
          <div id="<%= type %>-default" class="box" >
            <p>&nbsp;</p>
          </div>
        <% end -%>
        </section>
      <% end -%>
    </div>
  </div>
</div>
